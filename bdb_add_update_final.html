<!doctype html>
<html lang="en">
    <head>
    <meta charset="utf-8">
    <meta name="locale" content="US">
    <meta name="language" content="en">
    <meta name="country" content="US">
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Lighthouse Admin Portal</title>
    <link rel="stylesheet" href="https://scripts.cisco.com/cui/1.3.0/css/cui-standard.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/picomodal/3.0.0/picoModal.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.8.3/modernizr.js"></script>
    </head>
<body class="cui">
        <div class="content-fluid">
            <main>
                <header class="header header--tall">
                    <div class="header-bar container">
                        <a href="http://www.cisco.com/" class="header-bar__logo">
                            <span class="icon-cisco"></span>
                        </a>
                        <div class="header-bar__main">
                            <div class="header-breadcrumbs">
                            </div>
                            <div class="header-heading">
                                <h1 class="page-title"><img src='https://i.imgur.com/f0vBigO.jpg' alt=''>&nbsp;&nbsp;&nbsp;Lighthouse Admin Portal</h1>
                            </div>
                            <div class="header-menus">
                                <ul class="nav nav-tabs">
                                    <li class="tab">
                                        <a href="index.html"><div class="tab__heading" title="About">About</div></a>
                                    </li>
                                    <li class="tab">
                                        <a href="guide.html"><div class="tab__heading" title="Guidelines">Guidelines</div></a>
                                    </li>
                                    <li class="tab">
                                        <a href="user_view.html"><div class="tab__heading" title="View">View</div></a>
                                    </li>
                                    <li class="tab active">
                                        <a href="add_update.html"><div class="tab__heading" title="Add/Update">Add/Update</div></a>
                                    </li>
                                    <li class="tab">
                                        <a id ="admin" href="admin.html"><div class="tab__heading" title="Admin">Admin</div></a>
                                    </li>
                                    <li class="tab">
                                    <a id="stats" href="get_stats.html"><div class="tab__heading" title="Stats">Stats</div></a>
                                </li>
                                </ul>
                            </div>
                        </div>
                        <div class="header-toolbar">
                            <a href="mailto:lighthouse-csone@cisco.com?Subject=Lighthouse Admin Portal Feedback" class="btn btn--icon">
                                <span class="icon-alert"></span>
                            </a>
                            <span>&emsp;Feedback</span>
                        </div>
                    </div>
                </header>
                <div id="loading" class="loading-dots loading-dots--info">
                    <span></span><span></span><span></span><span></span><span></span><span></span>
                </div>
                <div class="content">
                    <div class="container">
                        <div class="section">
                            <div class="text-center">
                                <h1>Review or Edit Platforms and/or Technologies</h1>
                                <div>
                                <table id="pf_tbl" class="table">
                                <tbody><tr>
                                    <td id="platform_select_text" width="22%" align="left"><b>Select platform from existing list:</b></td>
                                    <td id="platform_select" width="22%"><select id="platform_list" style="width:100%"></select></td>
                                    <td id="platform_or" width="12%" align="center" style="font-size:18px"><b>OR</b></td>
                                    <td id="new_platform_text" width="22%" align="left"><b>Create new platform: (use only letters, digits and '-' symbols)</b></td>
                                    <td id="new_platform_input" width="22%"><input id="new_platform" style="width:100%" type="text"></td>
                                </tr></tbody></table>

                                <table id="tech_tbl" class="table">
                                <tbody><tr>
                                    <td id="tech_selection_text" width="22%" align="left"><b>Select technology from existing list:</b></td>
                                    <td id="tech_selection" width="22%"><select id="tech_list" style="width:100%"></select></td>
                                    <td id="tech_or" width="12%" align="center" style="font-size:18px"><b>OR</b></td>
                                    <td id="new_tech_input_text" width="22%" align="left"><b>Create new technology: (use only letters, digits and '-' symbols)</b></td>
                                    <td id="new_tech_input" width="22%"><input id="new_tech" style="width:100%" type="text" value=""></td>
                                </tr></tbody></table>

                                <table id="new_tech_tbl" class="table">
                                <tbody><tr>
                                    <td id="create_new_tech_text" width="50%" align="left"><b>Create new technology: (use only letters, digits and '-' symbols)</b></td>
                                    <td id="create_new_tech" width="50%"><input id="new_tech_new_plat" style="width:100%" type="text" value=""></td>
                                </tr></tbody></table>

                                <table class="table" >
                                <tbody><tr><td align="center"><b>Useful commands for troubleshooting</b></td>
                                </tr></tbody></table>

                                <table class="table">
                                <tbody><tr>
                                <td align="center"><textarea id="commands" rows="20" style="width:100%"></textarea></td>
                                </tr></tbody></table>

                                <table class="table">
                                <tbody><tr><td align="center"><b>Support links</b></td>
                                </tr></tbody></table>

                                <table class="table">
                                <tbody><tr>
                                <td align="center"><textarea id="links" rows="20" style="width:100%"></textarea></td>
                                </tr></tbody></table>
                                </div>
                        </div>
                    </div>
                </div>
                <div class="container">
                    <div class="section">
                        <div class="text-center">
                        <span id="preview_btn"><button class="btn btn--primary" onclick="preview()">Preview</button></span>
                        <span id="submit_btn"><button class="btn btn--success" onclick="update()">Submit</button></span>
                        <span><button class="btn btn--negative" onclick="reset_all()">Reset</button></span>
                        <span id="delete_btn"><button class="btn btn--secondary" onclick="delete_tech()">Delete</button></span>
                        </div>
                    </div>
                </div>
            </div>
                <footer class="footer footer--basic">
                    <div class="footer__links">
                        <ul class="list">
                            <li><a href="http://www.cisco.com/cisco/web/siteassets/contacts/index.html" target="_blank">Contacts</a></li>
                            <li><a href="https://secure.opinionlab.com/ccc01/o.asp?id=jBjOhqOJ" target="_blank">Feedback</a></li>
                            <li><a href="https://www.cisco.com/c/en/us/about/help.html" target="_blank">Help</a></li>
                            <li><a href="http://www.cisco.com/c/en/us/about/sitemap.html" target="_blank">Site Map</a></li>
                            <li><a href="https://www.cisco.com/c/en/us/about/legal/terms-conditions.html" target="_blank">Terms & Conditions</a></li>
                            <li><a href="https://www.cisco.com/c/en/us/about/legal/privacy-full.html" target="_blank">Privacy Statement</a></li>
                            <li><a href="https://www.cisco.com/c/en/us/about/legal/privacy-full.html#cookies" target="_blank">Cookie Policy</a></li>
                            <li><a href="https://www.cisco.com/c/en/us/about/legal/trademarks.html" target="_blank">Trademarks</a></li>
                        </ul>
                    </div>
                </footer>
            </main>
        </div>
    </body>
<div class="modal modal--small" id="modal-small" style="visibility:hidden">
    <div class="modal__dialog">
        <div class="modal__content">
            <div class="modal__body">
                <p class="subtitle" id="subtitle"></p>
            </div>
            <div class="modal__footer">
                <button class="btn" onclick="closeModal('modal-small')">Ok</button>
            </div>
        </div>
    </div>
</div>

<script>

$(document).ready(function(){
    get_cleared();
    get_admin();
    get_pf_list();
    });

$( document ).ajaxStart(function() {
        $( "#loading" ).show();
    });

$( document ).ajaxStop(function() {
        $( "#loading" ).hide();
});


var link = '/api/v2/jobs/lighthouse_v3_backend';
var task_name = "lighthouse_v3_backend";


function PaneOpen(html){
  var preview_modal = picoModal({
      content: html,
      overlayClose: false,
      closeButton: true,
      width: "85%",
  });
  return preview_modal;
}


function get_cleared(){
    $("#admin").hide();
    $("#stats").hide();
    $("#preview_btn").hide();
    $("#submit_btn").hide();
    $("#delete_btn").hide();
    $("#submit_btn").hide();
    $("#tech_tbl").hide();
    $("#new_tech_tbl").hide();
    $("#status").val("");
    $('#commands').val("");
    $('#new_tech').val("");
    $('#links').val("");
    $("#new_platform").val("");
    $("#new_tech_new_plat").val("");
    $('option', $('#tech_list')).remove();
}
    
    
function get_admin(){
    var inputs = {"action":"get_admin_status"};
    var post_data = {name: task_name, input: inputs};
    $.post({url: link, dataType: "json", data: post_data})
    .done(function(result){
       if(result.data.variables._0){
           console.log(result.data.variables._0);
           $("#admin").show();
           $("#stats").show();
       }
    });
}


function get_pf_list(){
    var inputs = {"action":"get_platform_list"};
    var post_data = {name: task_name, input: inputs};
    $.post({url: link, dataType: "json", data: post_data})
    .done(function(result){
       if(result.data.variables._0){
           console.log(result.data.variables._0);
           var pf_list = result.data.variables._0;
           var select = $('#platform_list');
           var options = select.prop('options');
           $('option', select).remove();
           options[options.length] = new Option("Platform selection", 'default', true, true);
           $.each(pf_list, function(val, text) {
               options[options.length] = new Option(text, text);
           });
       }
    });
}


$("#platform_list").change(function(){
    //alert("Platform selected.");
    $("#tech_tbl").show();
    $("#new_tech").val("");
    $("#commands").val("");
    $("#links").val("");
    $('option', $('#tech_list')).remove();
    $("#submit_btn").hide();
    $("#delete_btn").hide();
    $("#preview_btn").hide();
    $("#tech_or").show();
    $("#new_tech_input_text").show();
    $("#new_tech_input").show();    
    $("#tech_selection_text").show();
    $("#tech_selection").show();
    $("#new_tech_input_text").attr("width", "22%");
    $("#new_tech_input").attr("width", "22%");
    $("#tech_selection").attr("width", "22%");
    $("#tech_selection_text").attr("width", "22%");
    $("#platform_or").hide();
    $("#new_platform_text").hide();
    $("#new_platform_input").hide();
    $("#platform_select_text").attr("width", "50%");
    $("#platform_select").attr("width", "50%");
    var inputs = {"action":"get_technology_list", "platform" : $('#platform_list').val()};
    var post_data = {name: task_name, input: inputs};
    $.post({url: link, dataType: "json", data: post_data})
    .done(function(result){
        if(result.data.variables._0){
            console.log(result.data.variables._0);
            var tech_list = result.data.variables._0;
            var select = $('#tech_list');
            var options = select.prop('options');
            $('option', select).remove();
            options[options.length] = new Option("Technology selection", 'default', true, true);
            $.each(tech_list, function(val, text) {
                options[options.length] = new Option(text, text);
            });
        }
    });
});


$("#tech_list").change(function(){
    //alert("Technology selected.");
    $("#tech_or").hide();
    $("#new_tech_input_text").hide();
    $("#new_tech_input").hide();
    $("#submit_btn").hide();
    $("#delete_btn").hide()
    $("#preview_btn").hide();
    $('#commands').val("");
    $('#links').val("");
    $("#tech_selection_text").attr("width", "50%");
    $("#tech_selection").attr("width", "50%");
    var plat = $('#platform_list').val();
    var tech = $('#tech_list').val();
    var inputs = {"action":"get_technology", "platform" : plat, "technology" : tech};
    var post_data = {name: task_name, input: inputs};
    $.post({url: link, dataType: "json", data: post_data})
    .done(function(result){
        if(result.data.variables._0 || result.data.variables._1){
            console.log(result.data.variables._0);
            console.log(result.data.variables._1);
            var cmd = result.data.variables._0;
            var lnks = result.data.variables._1;
            $.each(cmd, function(val, text) {
                $('#commands').val($('#commands').val() + text + "\n")
            });
            $.each(lnks, function(val, text) {
                $('#links').val($('#links').val() + text + "\n")
            });
            $("#submit_btn").show();
            $("#delete_btn").show()
            $("#preview_btn").show();
            $("#user_view_btn").show();
        }
    });
});


$("#new_platform").change(function(){
    //alert("New Platform created.");
    var str = $("#new_platform").val();
    var n = str.search(/[^a-zA-Z0-9-]/);
    if (n == -1){
        $("#commands").val("");
        $("#links").val("");
        $("#platform_or").hide();
        $("#platform_select_text").hide();
        $("#platform_select").hide();
        $("#new_platform_text").attr("width", "50%");
        $("#new_platform_input").attr("width", "50%");
        $("#new_tech_tbl").show();
        } else{
        openModal("Use only letters, digits and '-' symbols");
        $("#new_platform").val("")
    }
});


$("#new_tech_new_plat").change(function(){
    var str = $("#new_tech_new_plat").val();
    var n = str.search(/[^a-zA-Z0-9-]/);
    if (n == -1){
        $("#commands").val("");
        $("#links").val("");
        $("#submit_btn").show();
    } else {
        openModal("Use only letters, digits and '-' symbols");
        $("#new_tech_new_plat").val("");
    }   
});


$("#new_tech").change(function(){
    //alert("New Technology created.");
    var str = $("#new_tech").val();
    var n = str.search(/[^a-zA-Z0-9-]/);
    if (n == -1){
    $("#tech_or").hide();
    $("#tech_selection_text").hide();
    $("#tech_selection").hide();
    $("#new_tech_input_text").attr("width", "50%");
    $("#new_tech_input").attr("width", "50%");
    $("#submit_btn").show();
    } else {
        //alert("Use only letters, digits and '-' symbols");
        openModal("Use only letters, digits and '-' symbols");
        $("#new_tech").val("");
    }
});


function delete_tech (){
    var plat = $('#platform_list').val();
    var tech = $('#tech_list').val();
    var inputs = {"action":"delete", "platform" : plat, "technology" : tech};
    var post_data = {name: task_name, input: inputs};
     $.post({url: link, dataType: "json", data: post_data})
    .done(function(result){
       if(result.data.variables._0){
           console.log(result.data.variables._0);
           openModal(result.data.variables._0)
           reset_all();
       }
    });
}


function preview (){
    var plat = $('#platform_list').val();
    var tech = $('#tech_list').val();
    var command = $("#commands").val().split("\n");
    var links = $("#links").val().split("\n");
    result_formatted = ""
    result_formatted += "<div style='text-align:right'><span class='thumbs-down' style='color:red' title='Not so much'><img src='https://i.imgur.com/ny0MElN.jpg' alt=''></span>&emsp;<span class='thumbs-up' style='color:green' title='Like'><img src='https://i.imgur.com/ZCPRCLc.jpg' alt=''></span>&emsp;</div>";
    result_formatted += "<b><font size='4'><div id='LighthouseContentTitle' style='text-align:center'><h3>Lighthouse : " + plat.toUpperCase() + " - " + tech.toUpperCase() + "</h3></div></b></font><div id='LighthouseContentBody'>";
    result_formatted += "<br><h3>" + "Useful Commands For Troubleshooting: (some commands syntax could vary according to platform or version)" + "</h3><br><br><div style='width:95%'";
    const cmds = Object.values(command)
    for (const item of cmds) {
      if (item.includes("//")) {
            command_comment = item.split("//")
            newItem = "<span>" + command_comment[0] + "</span>" + "<span style='color:green; float:right'>" + command_comment[1] + "</span>"
            result_formatted += newItem + "<br>"
        } else if (item.includes("Traces")) {
            result_formatted += "<br><span><h3>" + item + "</h3></span><br>"
        } else if (item.includes("Debugs")) {
            result_formatted += "<br><span><h3>" + item + "</h3></span><br>"
        } else if (item.includes("Techs:")) {
            result_formatted += "<br><span><h3>" + item + "</h3></span><br>"
        } else {
            result_formatted += "<span>" + item + "</span>" + "<br>"
        }  
    }
    result_formatted += "<br><h3>" + "Support Links: (links can become obsolete at any time, send feedback to help maintain accuracy)" + "</h3><br><br>";
    const lnks = Object.values(links)
    for (const item of lnks) {
      if (item.includes("http")|| item.includes("https")) {
            if (item.includes (">")) {
                text_link = item.split(">")
                result_formatted  += "<li><a href='" + text_link[1].trim() + "'target='_blank'>" + text_link[0] + "</a></li>"
            } else {
                result_formatted  += "<li><a href='" + item + "'target='_blank'>" + item + "</a></li>"
            }
      } else if (item.includes("@")) {
          result_formatted  += "<li><a href='mailto:" + item + "' target='_top'>Mailer : " + item + "</a></li>"
      } else {
          result_formatted += "<span>" + item + "</span>" + "<br>"
      }    
    }
    result_formatted += "</div><br></div><div id='LighthousePict' align='right'><img src='https://i.imgur.com/f0vBigO.jpg' alt=''></div>";
    result_formatted += "</div><br></div><div id='LighthouseReport' align='right'><a href='mailto:lighthouse-csone@cisco.com?Subject=Lighthouse%20Feedback' target='_top'>Click here to send comments or questions</a></div>";
    result_formatted += "</div><div id='LighthousePortal' align='right'><a href='https://scripts.cisco.com/app/lighthouse_v3_backend/index.html' target='_blank'>Click here to submit new content</a></div><br>";
    preview_modal = PaneOpen(result_formatted);
    preview_modal.show();
    };


function update(){
    if ($("#new_platform").val()){
        var plat = $("#new_platform").val();
        var techn = $("#new_tech_new_plat").val();
    } else if ($("#new_tech").val()){
        var plat =$("#platform_list").val();
        var techn = $("#new_tech").val();
    } else if (!($("#new_tech").val())){
        var plat =$("#platform_list").val();
        var techn = $("#tech_list").val();
    }
    if ($("#commands").val() || $("#links").val()){
        console.log(plat);
        console.log(techn);
        console.log("Commands and links fields are OK");
        var command = $("#commands").val();
        var links = $("#links").val();
        var inputs = {"action":"update", "platform" : plat, "technology" : techn, "commands" : command, "links": links};
        var post_data = {name: task_name, input: inputs};
        $.post({url: link, dataType: "json", data: post_data})
        .done(function(result){
           if(result.data.variables._0){
               console.log(result.data.variables._0);
               openModal(result.data.variables._0);
               reset_all();
           }
        });
    } else {
    console.log(plat);
    console.log(techn);
    console.log("Alarm, commands and links fields are empty");
    openModal("Commands and Links fields are both empty");
    }
}

function openModal(text){
    document.getElementById("modal-small").style.visibility = "visible";
    document.getElementById("subtitle").innerHTML = text;
    }

function closeModal(){
    document.getElementById("subtitle").innerHTML = "";
    document.getElementById("modal-small").style.visibility = "hidden"
    }

function reset_all(){
    $("#new_platform").val("");
    $("#new_tech").val("");
    $("#new_tech_new_plat").val("");
    $("#commands").val("");
    $("#links").val("");
    $('option', $('#tech_list')).remove();
    $('option', $('#platform_list')).remove();
    //hiding the elements, which are hidden in the beginning
    $("#admin").hide();
    $("#stats").hide();
    $("#tech_tbl").hide();
    $("#new_tech_tbl").hide();
    $("#submit_btn").hide();
    $("#delete_btn").hide();
    $("#preview_btn").hide();
    //Fading In all elments which faded out in the script
    $("#platform_or").show();
    $("#new_platform_text").show();
    $("#new_platform_input").show();
    $("#platform_select_text").show();
    $("#platform_select").show();
    $("#tech_or").show();
    $("#new_tech_input_text").show();
    $("#new_tech_input").show();
    $("#tech_selection_text").show();
    $("#tech_selection").show();
    //Restoring the width parameters for all elements
    $("#new_tech_input_text").attr("width", "22%");
    $("#new_tech_input").attr("width", "22%");
    $("#platform_select_text").attr("width", "22%");
    $("#platform_select").attr("width", "22%");
    $("#new_platform_text").attr("width", "22%");
    $("#new_platform_input").attr("width", "22%");
    $("#tech_selection").attr("width", "22%");
    $("#tech_selection_text").attr("width", "22%");
    get_admin();
    get_pf_list();;
}

</script>
</html>